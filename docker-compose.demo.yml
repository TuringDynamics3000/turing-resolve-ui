version: "3.9"

services:

  # -------------------------
  # UI GATEWAY (Mock API)
  # -------------------------
  ui-gateway:
    image: node:20-alpine
    container_name: risk-brain-ui-gateway
    working_dir: /app
    volumes:
      - ./apps/risk-brain-ui-gateway:/app
    command: sh -c "npm install && node server.js"
    ports:
      - "8080:8080"
    environment:
      - MODE=demo

  # -------------------------
  # GOVERNANCE UI (Next.js)
  # -------------------------
  ui:
    image: node:20-alpine
    container_name: risk-brain-ui
    working_dir: /app
    volumes:
      - ./apps/risk-brain-ui:/app
    command: sh -c "npm install && npm run dev"
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_UI_GATEWAY=http://localhost:8080/api/v1/ui
      - NEXT_PUBLIC_DEMO_AUTH=true
      - NEXT_PUBLIC_DEMO_USER_ROLE=operator
      - NEXT_PUBLIC_GRAFANA_URL=http://localhost:3001
    depends_on:
      - ui-gateway
      - grafana

  # -------------------------
  # PROMETHEUS (METRICS)
  # -------------------------
  prometheus:
    image: prom/prometheus:latest
    container_name: risk-brain-prometheus
    volumes:
      - ./demo/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  # -------------------------
  # GRAFANA (DASHBOARDS)
  # -------------------------
  grafana:
    image: grafana/grafana:latest
    container_name: risk-brain-grafana
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Viewer
    volumes:
      - ./demo/grafana/provisioning:/etc/grafana/provisioning
      - ./demo/grafana/dashboards:/var/lib/grafana/dashboards
    ports:
      - "3001:3000"
    depends_on:
      - prometheus
