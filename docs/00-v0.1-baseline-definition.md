# CU-Digital v0.1 ‚Äì Baseline Definition

**The Hard, Clean Baseline**

**Version:** 1.0  
**Date:** 2025-01-15  
**Status:** Mandatory Baseline

---

## Executive Summary

**v0.1 must land first as a hard, clean baseline proving that:**

1. **The Turing Protocol is enforced** ‚Äì No state mutation happens outside the Command Gateway
2. **The separation is real** ‚Äì The twin has zero access to TuringCore internals
3. **The architecture works** ‚Äì End-to-end flow from commands ‚Üí events ‚Üí projections is functional
4. **The system is honest** ‚Äì Balances are derivable from events, invariants hold, audit trails are complete

**Everything else comes after v0.1 passes.**

This is not a feature release. This is a **proof of architectural integrity**.

---

## What v0.1 Proves

### 1. Turing Protocol Enforcement

**Proof Required:**

Every state change in `CU_DIGITAL` tenant goes through:

```
Command ‚Üí Command Gateway ‚Üí Invariant Engine ‚Üí Event Store ‚Üí Projections
```

**No exceptions. No backdoors. No "just this once" shortcuts.**

**Evidence:**

- ‚úÖ HTTP access logs show **100% of writes** go to `/tenants/{tenantId}/commands`
- ‚úÖ Database audit logs show **zero direct writes** from twin orchestrator
- ‚úÖ Kafka consumer logs show **zero direct event production** from twin orchestrator
- ‚úÖ All state changes have corresponding events in `ledger_events` stream
- ‚úÖ All events have corresponding commands in command log

**Verification Method:**

```bash
# 1. Enable HTTP access logging on API Gateway
# 2. Run seed_cu_digital.py
# 3. Analyze logs:

grep "POST" api-gateway.log | grep -v "/tenants/.*/commands"
# Expected: No results (all POSTs go through Command Gateway)

grep "INSERT\|UPDATE\|DELETE" postgres-audit.log | grep "source=twin"
# Expected: No results (no direct DB writes from twin)

grep "PRODUCE" kafka-audit.log | grep "source=twin"
# Expected: No results (no direct event production from twin)
```

**Test Case:** TC-02 (Command Gateway Exclusivity)

---

### 2. Core-CU Separation

**Proof Required:**

The twin repository has **zero coupling** to TuringCore-v3 internals:

- ‚ùå No imports from `turingcore_v3` source code
- ‚ùå No direct database connections to TuringCore DB
- ‚ùå No direct Kafka producer access to TuringCore topics
- ‚ùå No shared libraries or modules (except published SDK)
- ‚ùå No environment variables pointing to internal services

**Only allowed:**

- ‚úÖ HTTP calls to public API endpoints
- ‚úÖ Published OpenAPI client SDK (when available)
- ‚úÖ Public documentation and specifications

**Evidence:**

- ‚úÖ Architecture tests pass (100% compliance)
- ‚úÖ CI/CD fails on any violation (automated enforcement)
- ‚úÖ Code review checklist includes separation verification
- ‚úÖ Twin can run against TuringCore without access to its source code

**Verification Method:**

```bash
# Run architecture tests
cd twin-orchestrator
pytest tests/architecture/test_separation_compliance.py -v

# All tests must pass:
# ‚úì TestNoForbiddenImports
# ‚úì TestNoDirectDatabaseConnections
# ‚úì TestAPIOnlyInteractions
# ‚úì TestNoEventProduction
# ‚úì TestNoInternalEndpoints
```

**Test Case:** TC-01 (Core vs Twin Separation)

---

### 3. End-to-End Functional Flow

**Proof Required:**

Complete lifecycle from tenant creation to money movement works via protocol:

**Bootstrap Phase:**
1. `CreateTenant` ‚Üí Tenant exists in projections
2. `UpsertProduct` ‚Üí Products exist in projections

**Seed Phase:**
3. `CreateCustomer` ‚Üí Customers exist in projections
4. `OpenAccount` ‚Üí Accounts exist with correct initial balances

**Simulate Phase:**
5. `PostEntry` ‚Üí Balances update, events recorded, audit trail complete

**Inspect Phase:**
6. Query projections ‚Üí Data matches expectations
7. Query events ‚Üí Complete audit trail exists
8. Validate invariants ‚Üí All 5 global invariants hold

**Evidence:**

- ‚úÖ 10 customers created successfully
- ‚úÖ 20 accounts opened (2 per customer: TXN + Savings)
- ‚úÖ 10+ transactions posted successfully
- ‚úÖ All projections consistent with event stream
- ‚úÖ Zero invariant violations logged

**Verification Method:**

```bash
# Run seed script
python -m seed_cu_digital

# Verify results
curl $TURINGCORE_BASE_URL/tenants/CU_DIGITAL/customers | jq '.customers | length'
# Expected: 10

curl $TURINGCORE_BASE_URL/tenants/CU_DIGITAL/accounts | jq '.accounts | length'
# Expected: 20

# Check for invariant violations
kubectl logs -n turingcore deployment/turingcore-api | grep -i "invariant.*violation"
# Expected: No results
```

**Test Cases:** TC-03 through TC-07

---

### 4. Ledger Integrity

**Proof Required:**

The ledger is the source of truth. Balances are **derivable** from events.

**For every account:**

```
projection_balance = sum(posting_legs_from_events)
```

**No exceptions. No "close enough". No unexplained deltas.**

**Evidence:**

- ‚úÖ Sample of 5 accounts tested: balance = sum of postings (within 0.01 rounding)
- ‚úÖ Event stream is complete (no gaps in sequence numbers)
- ‚úÖ Event stream is immutable (hash chain verified)
- ‚úÖ All postings balance (sum of legs = 0 for each entry)

**Verification Method:**

```python
# For each account:
def verify_ledger_coherence(account_id):
    # 1. Get projection balance
    account = client.get_account(account_id)
    projection_balance = account["balance"]
    
    # 2. Get all events
    events = client.get_account_events(account_id)
    
    # 3. Compute balance from events
    computed_balance = 0.0
    for event in events:
        if event["eventType"] == "PostingApplied":
            for leg in event["payload"]["legs"]:
                if leg["accountId"] == account_id:
                    if leg["direction"] == "DEBIT":
                        computed_balance += leg["amount"]
                    else:  # CREDIT
                        computed_balance -= leg["amount"]
    
    # 4. Assert equality (within rounding)
    assert abs(projection_balance - computed_balance) < 0.01
    
    return True
```

**Test Case:** TC-09 (Ledger Coherence)

---

### 5. Idempotency

**Proof Required:**

Running the same seed twice produces the **same result**, not double the data.

**Idempotency keys prevent:**
- ‚ùå Duplicate tenants
- ‚ùå Duplicate products
- ‚ùå Duplicate customers
- ‚ùå Duplicate accounts
- ‚ùå Duplicate transactions (double credits)

**Evidence:**

- ‚úÖ First run: 10 customers, 20 accounts
- ‚úÖ Second run: Still 10 customers, still 20 accounts
- ‚úÖ Balances unchanged (no double credits)
- ‚úÖ TuringCore returns "already processed" for duplicate commands

**Verification Method:**

```bash
# First run
python -m seed_cu_digital
COUNT_1=$(curl -s $TURINGCORE_BASE_URL/tenants/CU_DIGITAL/customers | jq '.customers | length')

# Second run (same config)
python -m seed_cu_digital
COUNT_2=$(curl -s $TURINGCORE_BASE_URL/tenants/CU_DIGITAL/customers | jq '.customers | length')

# Verify counts are equal
[ "$COUNT_1" -eq "$COUNT_2" ] && echo "‚úì Idempotent" || echo "‚úó FAIL"
```

**Test Case:** TC-08 (Idempotent Seed Behaviour)

---

## What v0.1 Does NOT Include

**Out of Scope:**

- ‚ùå Advanced banking features (loans, interest accrual, fees)
- ‚ùå Payment rails (NPP, BPAY, cards)
- ‚ùå AML/fraud detection
- ‚ùå Advanced scenarios (recession, fraud, CPS 230 outage)
- ‚ùå User interfaces (operator console, member portal)
- ‚ùå Full observability stack (Grafana, ELK)
- ‚ùå Performance optimization (just needs to complete, not be fast)
- ‚ùå Multi-tenant demo (just CU_DIGITAL)
- ‚ùå Production deployment (dev/demo cluster only)
- ‚ùå Customer pilots
- ‚ùå Sales demos
- ‚ùå Pricing models
- ‚ùå Marketing materials

**These come AFTER v0.1 baseline is proven solid.**

---

## Acceptance Criteria

v0.1 is **accepted** when:

### Technical Criteria

1. ‚úÖ **All 10 test cases pass** (TC-01 through TC-10)
2. ‚úÖ **Architecture tests pass** (100% compliance)
3. ‚úÖ **Ledger coherence verified** (balance = sum of postings for all accounts)
4. ‚úÖ **Zero invariant violations** during seed execution
5. ‚úÖ **Idempotency verified** (re-run produces same result)
6. ‚úÖ **Event stream complete** (all commands have events)
7. ‚úÖ **Audit trail complete** (all state changes traceable)

### Operational Criteria

8. ‚úÖ **Seed completes successfully** from clean environment
9. ‚úÖ **Seed is repeatable** (same config, same result)
10. ‚úÖ **No pod crashes** during execution
11. ‚úÖ **No manual interventions** required
12. ‚úÖ **QA can run independently** using only twin repo + runbook

### Documentation Criteria

13. ‚úÖ **Acceptance test spec complete** (this document + TC-01 to TC-10)
14. ‚úÖ **Runbook complete** (QA can execute without developer help)
15. ‚úÖ **Known issues documented** (with tickets and mitigation plans)

---

## Success Metrics

### Binary Metrics (Pass/Fail)

- **Protocol enforcement:** 100% or FAIL
- **Separation compliance:** 100% or FAIL
- **Ledger coherence:** 100% or FAIL
- **Idempotency:** 100% or FAIL
- **Test case pass rate:** 100% or FAIL

**There is no "mostly working" for v0.1. It either proves the architecture or it doesn't.**

### Performance Metrics (Informational Only)

- **Seed execution time:** <15 minutes for 10 customers (target, not requirement)
- **API response time:** p95 < 1 second (target, not requirement)
- **Event throughput:** >100 events/sec (target, not requirement)

**Performance optimization comes AFTER v0.1 proves correctness.**

---

## Exit Criteria

v0.1 can be declared **"baseline ready"** when:

1. ‚úÖ All acceptance criteria met (15/15)
2. ‚úÖ All test cases pass (10/10)
3. ‚úÖ QA sign-off received
4. ‚úÖ Architecture team sign-off received
5. ‚úÖ Platform team sign-off received

**At that point:**

- ‚úÖ v0.1 baseline is **locked** (no changes without regression testing)
- ‚úÖ v0.2 development can begin (advanced scenarios)
- ‚úÖ UI development can begin (operator console, member portal)
- ‚úÖ Infrastructure work can begin (staging deployment)

---

## What Happens After v0.1

**Immediate Next Steps (v0.2):**

1. **Scale testing** ‚Äì Increase to 100 customers, then 500
2. **Performance optimization** ‚Äì Reduce seed time to <5 minutes
3. **Advanced scenarios** ‚Äì Implement recession, fraud, outage scenarios
4. **Observability** ‚Äì Deploy Grafana dashboards

**Short-Term (v0.3-v0.5):**

5. **Operator console** ‚Äì React UI for back-office operations
6. **Member portal** ‚Äì React UI for digital banking
7. **Staging deployment** ‚Äì Deploy to staging environment
8. **Demo playbooks** ‚Äì Create sales demo scripts

**Medium-Term (v0.6-v1.0):**

9. **Production readiness** ‚Äì Security audit, load testing, DR testing
10. **Pilot customers** ‚Äì Onboard 2-3 credit unions
11. **Regulatory walkthrough** ‚Äì APRA CPS 230/234 demonstrations
12. **Go-to-market** ‚Äì Sales enablement, marketing materials

**But none of this happens until v0.1 proves the foundation is solid.**

---

## Critical Path to v0.1

### Week 1 (Jan 15-22)

**TuringCore-v3 (Platform Team):**
- [ ] Implement Command Gateway endpoint
- [ ] Implement 5 command handlers (CreateTenant, UpsertProduct, CreateCustomer, OpenAccount, PostEntry)
- [ ] Implement 3 query endpoints (customers, accounts, events)
- [ ] Add protocol conformance tests

**Twin Repo (Twin Team):**
- [ ] Run architecture tests (should pass with current code)
- [ ] Set up CI/CD pipeline
- [ ] Prepare test environment

### Week 2 (Jan 22-29)

**Integration:**
- [ ] Connect twin to TuringCore API
- [ ] Run seed_cu_digital.py end-to-end
- [ ] Debug any issues
- [ ] Verify all 10 test cases pass

**Documentation:**
- [ ] Update runbook based on actual execution
- [ ] Document any deviations or workarounds
- [ ] Prepare QA handoff

### Week 3 (Jan 29 - Feb 5)

**QA Validation:**
- [ ] QA runs all 10 test cases independently
- [ ] QA verifies acceptance criteria
- [ ] QA documents results

**Sign-Off:**
- [ ] Architecture team reviews and approves
- [ ] Platform team reviews and approves
- [ ] Product team reviews and approves

**Target Date:** 2025-02-05 (3 weeks from now)

---

## Risk Mitigation

### Risk: TuringCore API Not Ready

**Impact:** Cannot run seed script, cannot validate v0.1

**Mitigation:**
- Start with mock API for twin development
- Parallel development of TuringCore API
- Daily sync between teams

**Status:** üü° In progress

---

### Risk: Protocol Violations Discovered

**Impact:** Architecture assumptions invalid, major rework required

**Mitigation:**
- Architecture tests catch violations early
- Code review checklist includes protocol compliance
- Daily automated testing

**Status:** üü¢ Mitigated (tests in place)

---

### Risk: Ledger Coherence Fails

**Impact:** Event sourcing implementation has bugs, balances don't match events

**Mitigation:**
- Start with simple test cases (10 customers, basic transactions)
- Validate ledger coherence on every test run
- Debug with event stream inspection tools

**Status:** üü° To be validated

---

### Risk: Performance Unacceptable

**Impact:** Seed takes too long, demo experience poor

**Mitigation:**
- Performance is informational only for v0.1 (not a blocker)
- Optimize in v0.2 after correctness proven
- Start with small scale (10 customers) for faster iteration

**Status:** üü¢ Mitigated (not a v0.1 requirement)

---

## Summary

**v0.1 is a proof of architectural integrity, not a feature release.**

**It proves:**
1. ‚úÖ Turing Protocol is enforced (no backdoors)
2. ‚úÖ Separation is real (no coupling)
3. ‚úÖ Architecture works (end-to-end flow functional)
4. ‚úÖ System is honest (balances derivable from events)
5. ‚úÖ Operations are repeatable (idempotency works)

**When v0.1 passes, we have a solid foundation to build on.**

**When v0.1 fails, we fix it before moving forward.**

**No shortcuts. No "good enough". No "we'll fix it later".**

**v0.1 is the baseline. Everything else depends on it.**

---

## References

- [Turing Protocol Specification](./TURING_PROTOCOL_V2.md)
- [Core Separation Principles](./06-core-separation-principles.md)
- [API Contract Specification](./07-api-contract-specification.md)
- [Acceptance Test Specification](./08-acceptance-test-specification.md)
- [Action Checklist](./ACTION_CHECKLIST.md)

---

**Document Version:** 1.0  
**Last Updated:** 2025-01-15  
**Owner:** TuringCore Platform Team  
**Reviewers:** Architecture Team, QA Team  
**Status:** Mandatory Baseline
